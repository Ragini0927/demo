import * as html2canvasModule from 'html2canvas';

it('should generate and download a PDF for privacy policy', async () =>
{
	const mockHtml = '<div>{{policyContent}}</div><div>{{contentHeading}}</div>';
	const spyHttpGet = spyOn(httpClient, 'get').and.returnValue(of(mockHtml));

	const canvasMock = document.createElement('canvas');
	Object.defineProperty(canvasMock, 'width', { value: 1000 });
	Object.defineProperty(canvasMock, 'height', { value: 2000 });

	const mockToDataURL = jasmine.createSpy().and.returnValue('data:image/png;base64,mockimage');
	canvasMock.toDataURL = mockToDataURL;

	const html2canvasSpy = spyOn(html2canvasModule.default, 'default').and.returnValue(Promise.resolve(canvasMock));

	const saveSpy = jasmine.createSpy();
	const addImageSpy = jasmine.createSpy();
	const addPageSpy = jasmine.createSpy();

	spyOn<any>(jsPDF.prototype, 'addImage').and.callFake(addImageSpy);
	spyOn<any>(jsPDF.prototype, 'addPage').and.callFake(addPageSpy);
	spyOn<any>(jsPDF.prototype, 'save').and.callFake(saveSpy);

	component.privacyData = ['Mock Privacy Content'];
	component.termsData = ['Mock Terms Content'];
	component.contentPagelabels = mockContentPageLabels;

	await component.downloadPdf('privacy');

	expect(spyHttpGet).toHaveBeenCalledWith('assets/templates/aggrement.html', { responseType: 'text' });
	expect(html2canvasSpy).toHaveBeenCalled();
	expect(addImageSpy).toHaveBeenCalled();
	expect(saveSpy).toHaveBeenCalledWith('PrivacyPolicy.pdf');
});
